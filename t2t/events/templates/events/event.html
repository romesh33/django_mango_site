{% extends "base.html" %}

{% load staticfiles %}
{% block custom_static %}
    <!-- Custom styles for this template -->
    <link href="{% static "css/jumbotron-narrow.css" %}" rel="stylesheet">
    <link href="{% static "css/event_styles.css" %}" rel="stylesheet">

    <script src='{% static "js/react.js" %}'></script>
    <script src='{% static "js/react-dom.js" %}'></script>
    <!--<script src='{% static "js/require.js" %}'></script>-->
    <!--<script src='https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.js'></script>-->
    <script src='{% static "js/browser_babel.js" %}'></script>
{% endblock custom_static %}

{% block title %}{{ event.event_name }}{% endblock %}

{% block content %}
<div class="container">
    <ol class="breadcrumb">
        <li><a href="{% url 'main' %}">Главная</a></li>
        <li><a href="{% url 'events:events' %}">События</a></li>
        <li class="active">{{ event.event_name }}</li>
    </ol>
    <div class="page-header">
            <h3>{{ event.event_name }}</h3>
        </div>
    <div class="well">
        {{ event.description }}
    </div>
    <div id="container">
      <p>
        To install React, follow the instructions on
        <a href="https://github.com/facebook/react/">GitHub</a>.
      </p>
      <p>
        If you can see this, React is <strong>not</strong> working right.
        If you checked out the source from GitHub make sure to run <code>grunt</code>.
      </p>
    </div>
    <div class="row">
        <div class="col-md-2 col-sm-2" id="statistics">
            <h4>Статистика</h4>
            <p>Ромко - 5</p>
            <p>Ваня - 10</p>
            <p>Санька - 15</p>
            <p>Сергей - 3</p>
        </div>
        <div class="col-md-8 col-sm-8">
            <div id="new_chat"></div>
            <h4>Чат</h4>
            Подключенные пользователи: <span id="connected_users"></span><br>
            <div id="chat">
                {% if chat_messages %}
                    {% for message in chat_messages %}
                        <p>{{message.creation_time|date:"D d M Y" }} {{message.creation_time|time:"H:i" }}: {{message.sender}}: {{ message.text }}</p>
                    {% endfor %}
                {% else %}
                    <p id="empty_chat_message">
                        Здесь будут сообщения от пользователей.
                    </p>
                {% endif %}
            </div>

            <form id="chatform">
                {% csrf_token %}
                <div class="form-group row">
                    {{ chat_message_form }}
                    <button type="submit" class="btn btn-default">Отправить</button>
                </div>
                <!--<input name="message_text" id="message_text" type="text" maxlength="1000" height="100px" width="300px">
                <br>
                <input type="submit" name="submit" value="Отправить" />-->
            </form>
        </div>
        <div class="col-md-2 col-sm-2" id="actions">
            <h4>События</h4>
            <div id="content"></div>
            <p>10:00 - Заведен баг №100</p>
            <p>10:15 - Заведен баг №101</p>
            <p>10:16 - Заведен баг №103</p>
            <p>10:16 - Заведен баг №104</p>
            <a href="{% url 'bugs:addTicket' event.id %}">Завести баг</a>
        </div>
    </div>

</div>
{% endblock %}

{% block more_scripts %}
    <!--<script src='{% static "js/EventEmitter.js" %}' type="text/babel"></script>-->
    <script>
        alert("1");
        var messages = "{{ chat_messages|safe }}";
        console.log(messages);
        alert("2");
    </script>
    <script src='{% static "js/example.js" %}' type="text/babel"></script>
    <script src='{% static "js/multichat.js" %}' type="text/babel"></script>
    <script src='{% static "js/reconnecting-websocket.min.js" %}' type="text/javascript"></script>
    <script>
      var ExampleApplication = React.createClass({
        render: function() {
          var elapsed = Math.round(this.props.elapsed  / 100);
          var seconds = elapsed / 10 + (elapsed % 10 ? '' : '.0' );
          var message =
            'React has been successfully running for ' + seconds + ' seconds.';

          return React.DOM.p(null, message);
        }
      });

      // Call React.createFactory instead of directly call ExampleApplication({...}) in React.render
      var ExampleApplicationFactory = React.createFactory(ExampleApplication);

      var start = new Date().getTime();
      setInterval(function() {
        ReactDOM.render(
          ExampleApplicationFactory({elapsed: new Date().getTime() - start}),
          document.getElementById('container')
        );
      }, 50);
    </script>
{% endblock more_scripts %}